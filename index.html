<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TSIC Level Editor</title>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <!-- Top Toolbar -->
    <div id="toolbar">
        <div class="toolbar-section">
            <h1>TSIC Level Editor</h1>
        </div>

        <div class="toolbar-section" id="project-selector-section">
            <label>Project:</label>
            <select id="project-dropdown">
                <option value="">New Project...</option>
            </select>
            <div id="project-loading-spinner" class="loading-spinner" style="display: none;"></div>
            <input type="text" id="project-name-input" placeholder="Enter project name..." style="display: none;">
            <button id="btn-create-project" style="display: none;">Create</button>
            <button id="btn-cancel-new-project" style="display: none;">Cancel</button>
        </div>

        <div class="toolbar-section">
            <button id="btn-new" title="New Project">New</button>
            <button id="btn-import" title="Import Level from JSON">Import</button>
            <button id="btn-export" title="Export Level to JSON">Export</button>
            <button id="btn-delete-project" title="Delete Current Project" style="display: none;">Delete</button>
            <button id="btn-load-test-map" title="Generate Test Map with Splodges">Load Test Map</button>
            <input type="file" id="file-input" accept=".json" style="display: none;">
        </div>

        <div class="toolbar-section">
            <label>Grid Size:</label>
            <select id="grid-size-select">
                <option value="256">256√ó256</option>
                <option value="512" selected>512√ó512</option>
                <option value="1024">1024√ó1024</option>
            </select>
            <button id="btn-resize-grid">Apply</button>
        </div>

        <div class="toolbar-section">
            <label>Zoom:</label>
            <button id="btn-zoom-out">-</button>
            <span id="zoom-level">100%</span>
            <button id="btn-zoom-in">+</button>
            <button id="btn-zoom-fit">Fit</button>
        </div>

        <div class="toolbar-section">
            <label>
                <input type="checkbox" id="show-grid" checked>
                Show Grid
            </label>
        </div>

        <div class="toolbar-section">
            <label>
                <input type="checkbox" id="show-guides" checked>
                Guide Lines
            </label>
            <label style="margin-left: 10px;">H:</label>
            <input type="number" id="guide-horizontal" min="1" max="10" value="2" style="width: 40px;">
            <label style="margin-left: 5px;">V:</label>
            <input type="number" id="guide-vertical" min="1" max="10" value="2" style="width: 40px;">
        </div>
    </div>

    <!-- Tool Options Bar -->
    <div id="tool-options">
        <div class="option-group">
            <button id="btn-undo" title="Undo (Ctrl+Z)">‚Ü∂ Undo</button>
            <button id="btn-redo" title="Redo (Ctrl+Y)">‚Ü∑ Redo</button>
        </div>

        <div class="option-group">
            <label id="brush-size-label">Brush Size: 1</label>
            <input type="range" id="brush-size" min="1" max="50" value="1" style="width: 150px;">
        </div>

        <div class="option-group">
            <label id="layer-opacity-label">Top Layer Opacity: 100%</label>
            <input type="range" id="layer-opacity" min="0" max="100" value="100" style="width: 150px;">
        </div>

        <div class="option-group">
            <label>Brush Shape:</label>
            <div class="segmented-control" id="brush-shape-control">
                <button class="segment active" data-value="square">Square</button>
                <button class="segment" data-value="circle">Circle</button>
            </div>
        </div>

        <div class="option-group" id="shape-options" style="display: none;">
            <label>
                <input type="checkbox" id="fill-mode" checked>
                Filled
            </label>
        </div>

        <div class="option-group" id="wand-options" style="display: none;">
            <label>
                <input type="checkbox" id="wand-diagonal">
                Include Diagonals
            </label>
        </div>
    </div>

    <!-- Main Container -->
    <div id="main-container">
        <!-- Left Panel - Tools & Palette -->
        <div id="left-panel">
            <div class="panel-section">
                <h3>Tools</h3>
                <div id="tools">
                    <button class="tool-btn active" data-tool="pencil" title="Pencil (B)">
                        <span class="tool-icon">‚úèÔ∏è</span>
                        <span class="tool-name">Pencil (B)</span>
                    </button>
                    <button class="tool-btn" data-tool="bucket" title="Bucket Fill (G)">
                        <span class="tool-icon">ü™£</span>
                        <span class="tool-name">Bucket (G)</span>
                    </button>
                    <button class="tool-btn" data-tool="line" title="Line (L)">
                        <span class="tool-icon">üìè</span>
                        <span class="tool-name">Line (L)</span>
                    </button>
                    <button class="tool-btn" data-tool="rectangle" title="Shape (R)">
                        <span class="tool-icon">‚ñ≠</span>
                        <span class="tool-name">Shape (R)</span>
                    </button>
                    <button class="tool-btn" data-tool="eyedropper" title="Eyedropper (I)">
                        <span class="tool-icon">üíß</span>
                        <span class="tool-name">Picker (I)</span>
                    </button>
                    <button class="tool-btn" data-tool="eraser" title="Eraser (E)">
                        <span class="tool-icon">üßπ</span>
                        <span class="tool-name">Eraser (E)</span>
                    </button>
                    <button class="tool-btn" data-tool="pan" title="Pan (H)">
                        <span class="tool-icon">‚úã</span>
                        <span class="tool-name">Pan (H)</span>
                    </button>
                    <button class="tool-btn" data-tool="selection" title="Selection (M)">
                        <span class="tool-icon">‚¨ö</span>
                        <span class="tool-name">Select (M)</span>
                    </button>
                    <button class="tool-btn" data-tool="wand" title="Magic Wand (W)">
                        <span class="tool-icon">‚ú®</span>
                        <span class="tool-name">Wand (W)</span>
                    </button>
                </div>
            </div>

            <div class="panel-section">
                <h3>Color Palette</h3>
                <div id="current-color-display">
                    <div id="current-color" style="background-color: #7CFC00;"></div>
                    <div id="current-color-label">None Selected</div>
                </div>
                <div id="color-search-container">
                    <input type="text" id="color-search" placeholder="Search colors..." autocomplete="off">
                    <button id="color-search-clear" title="Clear search">√ó</button>
                </div>
                <div id="color-palette">
                    <!-- Colors loaded from config -->
                </div>
            </div>

            <div class="panel-section">
                <h3>Statistics</h3>
                <div id="statistics">
                    <div class="stat-row">
                        <span>Tiles:</span>
                        <span id="stat-tiles">0</span>
                    </div>
                    <div class="stat-row">
                        <span>Empty:</span>
                        <span id="stat-empty">65536</span>
                    </div>
                </div>
            </div>

            <div class="panel-section">
                <h3>Copy History</h3>
                <div id="copy-history">
                    <div class="copy-history-empty">No copies yet</div>
                </div>
            </div>
        </div>

        <!-- Center Panel - Canvas -->
        <div id="center-panel">
            <div id="canvas-container">
                <canvas id="grid-canvas"></canvas>
                <canvas id="preview-canvas"></canvas>
            </div>
        </div>

        <!-- Right Panel - Layers -->
        <div id="right-panel">
            <!-- Minimap -->
            <div id="minimap-section" class="panel-section">
                <h3>Minimap</h3>
                <div id="minimap-container">
                    <canvas id="minimap-canvas"></canvas>
                </div>
            </div>

            <div class="panel-section">
                <h3>Layers</h3>
                <div id="layers-list">
                    <!-- Layers loaded from config -->
                </div>
            </div>

            <!-- Maze Visualizer Panel -->
            <div class="panel-section">
                <h3>Maze Visualizer</h3>

                <!-- Layer Toggle Buttons -->
                <div class="control-group">
                    <label>Select Layer:</label>
                    <div class="segmented-control" id="maze-layer-control">
                        <button class="segment" data-layer="floor">Floor</button>
                        <button class="segment" data-layer="underground">Underground</button>
                        <button class="segment" data-layer="sky">Sky</button>
                    </div>
                </div>

                <!-- Visualizer Content (shown when layer selected) -->
                <div id="maze-visualizer-content" style="display: none;">

                    <!-- Visualization Mode -->
                    <div class="control-group">
                        <label for="maze-viz-mode">Mode:</label>
                        <select id="maze-viz-mode" class="control-select">
                            <option value="regions" selected>Flood Fill Regions</option>
                            <option value="arrows">Maze Directions (Arrows)</option>
                            <option value="walls">Maze Walls</option>
                            <option value="connections">Connection Lines</option>
                        </select>
                    </div>

                    <!-- Settings Collapsible Section -->
                    <div class="collapsible-section">
                        <div class="collapsible-header" id="maze-settings-header">
                            <span>Settings</span>
                            <span class="collapse-icon">‚ñº</span>
                        </div>
                        <div class="collapsible-content" id="maze-settings-content">

                            <!-- Border Biomes -->
                            <div class="control-group">
                                <label>Border Biomes:</label>
                                <div id="maze-border-biomes" class="checkbox-group">
                                    <label class="checkbox-label">
                                        <input type="checkbox" value="Biome_Blocked" checked> Blocked
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" value="Biome_Pit" checked> Pit
                                    </label>
                                    <label class="checkbox-label">
                                        <input type="checkbox" value="Biome_SkyCeiling" checked> Sky Ceiling
                                    </label>
                                </div>
                            </div>

                            <!-- Max Height Difference -->
                            <div class="control-group">
                                <label for="maze-height-diff">Max Height Diff:</label>
                                <input type="number" id="maze-height-diff" class="control-input" min="0" max="64" value="1">
                                <span class="control-hint">Adjacent tiles must differ by ‚â§ this value</span>
                            </div>

                            <!-- Seed -->
                            <div class="control-group">
                                <label for="maze-seed">Seed:</label>
                                <input type="number" id="maze-seed" class="control-input" value="12345">
                            </div>

                        </div>
                    </div>

                    <!-- Actions -->
                    <div class="control-group">
                        <button id="btn-regenerate-maze" class="control-button">Regenerate</button>
                        <button id="btn-export-maze-data" class="control-button">Export JSON</button>
                    </div>

                    <!-- Statistics -->
                    <div class="stats-container" id="maze-stats" style="display: none;">
                        <h4>Statistics</h4>
                        <div id="maze-stats-content"></div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Tile Inspector Panel (floating) -->
    <div id="tile-inspector" class="floating-panel" style="display: none;">
        <div class="panel-header">
            <h4>Tile Inspector</h4>
            <button id="tile-inspector-close" class="close-button">√ó</button>
        </div>
        <div id="tile-inspector-content" class="panel-content"></div>
    </div>

    <!-- Status Bar -->
    <div id="status-bar">
        <span id="status-position">X: 0, Y: 0</span>
        <span id="status-hover-info"></span>
        <span id="status-filename">No project loaded</span>
        <span id="status-message">Ready</span>
        <span id="status-autosave"></span>
    </div>

    <!-- Scripts -->
    <script src="js/config.js"></script>
    <script src="js/color-mapper.js"></script>
    <script src="js/layers.js"></script>
    <script src="js/rle-encoder.js"></script>
    <script src="js/rle-validator.js"></script>
    <script src="js/dynamic-validator.js"></script>
    <script src="js/tools.js"></script>
    <script src="js/editor.js"></script>
    <script src="js/validation.js"></script>
    <script src="js/export-png.js"></script>
    <script src="js/export-metadata.js"></script>
    <script src="js/perlin-noise.js"></script>
    <script src="js/base64-rle-encoder.js"></script>
    <script src="js/maze-algorithms.js"></script>
    <script src="js/maze-visualizer.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
