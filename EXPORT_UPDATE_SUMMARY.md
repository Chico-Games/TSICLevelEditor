# Export Format Update Summary

## What Changed

The JSON export now includes **all color-to-enum mappings** and **step-by-step instructions** directly in the exported file.

## New Export Structure

Every exported JSON now has **4 sections** instead of 2:

### 1. `metadata` (unchanged)
```json
{
  "name": "ProjectName",
  "description": "Generated by TSIC Level Editor",
  "world_size": 256,
  "maze_generation_seed": 1234567890
}
```

### 2. `layers` (unchanged)
```json
[
  {
    "layer_type": "Height",
    "palette": ["#0a0a0a", "#525d6b"],
    "color_data": [[0, 30000], [1, 35536]]
  }
]
```

### 3. `color_mappings` (NEW!)
```json
{
  "biomes": {
    "#ff6b6b": { "value": 1, "name": "Biome_ShowFloor", "description": "..." },
    // ... all 23 biomes (0-22)
  },
  "heights": {
    "#0a0a0a": { "value": 0, "name": "Height_Underground_Deep", "description": "..." },
    // ... all 10 heights (0-9)
  },
  "difficulty": {
    // ... all 5 difficulty levels (0-4)
  },
  "hazards": {
    // ... all 3 hazard types (0-2)
  }
}
```

### 4. `format_info` (NEW!)
```json
{
  "description": "JSON-RLE (Run-Length Encoding) format for TSIC world generation",
  "version": "1.0",
  "how_to_read": {
    "step_1": "Each layer has a 'palette' (array of colors) and 'color_data' (RLE compressed data)",
    "step_2": "RLE format: [[paletteIndex, count], ...] where paletteIndex references palette array",
    "step_3": "Decompress: for each [index, count], repeat palette[index] for count tiles",
    "step_4": "Tiles are stored in row-major order: index = y * world_size + x",
    "step_5": "Use color_mappings below to convert colors to enum values for each layer type"
  }
}
```

## Benefits

✅ **Self-documenting** - No external guide needed
✅ **All mappings included** - Every color-to-enum conversion is in the file
✅ **Step-by-step instructions** - format_info tells you exactly how to read it
✅ **Easy for other AIs** - Your other AI can read the JSON and understand it immediately
✅ **No external dependencies** - Everything needed is in one file

## Example

See `EXAMPLE_EXPORT.json` for a complete example with all mappings.

## Code Changes

Modified `js/layers.js`:
- Added `generateColorMappings()` method to LayerManager
- Updated `exportRLEData()` to include color_mappings and format_info
- All exports now include the full documentation

## Updated Documentation

- `JSON_FORMAT_GUIDE.md` - Updated to document new sections
- `EXAMPLE_EXPORT.json` - Complete example with all 4 sections

## Next Export

The next time you export a JSON file, it will automatically include:
- All 23 biome mappings (0-22)
- All 10 height mappings (0-9)
- All 5 difficulty mappings (0-4)
- All 3 hazard mappings (0-2)
- Complete instructions on how to read the format

Your other AI will be able to read the exported JSON file and have everything it needs to implement a reader!
